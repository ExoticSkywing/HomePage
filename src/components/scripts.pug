// 本地优先加载，失败再回退到 CDN；统一使用 defer 以避免阻塞渲染
script(
  src="assets/vendor/anime.min.js"
  defer
  onerror="(function(){var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js';s.defer=true;document.head.appendChild(s)})()"
)
// 传统 UMD 版本，提供全局 THREE（避免 ESM 导致的 export/require 报错）
script(
  src="assets/vendor/three.min.js"
  defer
  onerror="(function(){var s=document.createElement('script');s.src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';s.defer=true;document.head.appendChild(s)})()"
)
script(
  src="assets/vendor/OrbitControls.min.js"
  defer
  onerror="(function(){var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js';s.defer=true;document.head.appendChild(s)})()"
)


script.
	window.$ = selector => document.querySelector(selector)
	const getOriginalContent = selector => $(selector).getAttribute("original-content")
	window.subtitle = getOriginalContent(".content-subtitle")
	window.signature = getOriginalContent("#signature")
	window.config = {
		SIM_RESOLUTION: 128,
		DYE_RESOLUTION: 1024,
		CAPTURE_RESOLUTION: 512,
		DENSITY_DISSIPATION: 1,
		VELOCITY_DISSIPATION: 0.2,
		PRESSURE: 0.8,
		PRESSURE_ITERATIONS: 20,
		CURL: 30,
		SPLAT_RADIUS: 0.25,
		SPLAT_FORCE: 6000,
		SHADING: true,
		COLORFUL: true,
		COLOR_UPDATE_SPEED: 10,
		PAUSED: false,
		BACK_COLOR: { r: 30, g: 31, b: 33 },
		TRANSPARENT: false,
		BLOOM: true,
		BLOOM_ITERATIONS: 8,
		BLOOM_RESOLUTION: 256,
		BLOOM_INTENSITY: 0.4,
		BLOOM_THRESHOLD: 0.8,
		BLOOM_SOFT_KNEE: 0.7,
		SUNRAYS: true,
		SUNRAYS_RESOLUTION: 196,
		SUNRAYS_WEIGHT: 1.0,
	}

script(src='js/main.js' defer)

if intro.background
	script(src='js/background.js' defer)

if intro.supportAuthor
	script(src="assets/vendor/log.min.js" defer onerror="(function(){var s=document.createElement('script');s.src='https://cdn.jsdelivr.net/gh/SimonAKing/js/log.min.js';s.defer=true;document.head.appendChild(s)})()")
